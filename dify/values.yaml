# Dify Helm values (RAG: Qdrant rag NS, MinIO devops NS, Ingress)
# install.sh substitutes k8s_project, k8s_domain before use
# PVC: NFS StorageClass (nfs-client) for api/worker shared ReadWriteMany

image:
  api:
    repository: langgenius/dify-api
    tag: "1.11.4"
    pullPolicy: IfNotPresent
  web:
    repository: langgenius/dify-web
    tag: "1.11.4"
    pullPolicy: IfNotPresent
  sandbox:
    repository: langgenius/dify-sandbox
    tag: "0.2.12"
    pullPolicy: IfNotPresent
  proxy:
    repository: nginx
    tag: latest
    pullPolicy: IfNotPresent

# Vector DB: use existing RAG Qdrant (rag namespace)
api:
  extraEnv:
    - name: CHECK_UPDATE_URL
      value: ""
    - name: VECTOR_STORE
      value: "qdrant"
    - name: QDRANT_URL
      value: "http://qdrant.rag.svc.cluster.local:6333"
    - name: QDRANT_API_KEY
      value: ""
    # MinIO(S3) â€” OpenDAL reads only OPENDAL_S3_*. Secret: S3_ACCESS_KEY, S3_SECRET_KEY
    - name: STORAGE_TYPE
      value: "opendal"
    - name: OPENDAL_SCHEME
      value: "s3"
    - name: OPENDAL_S3_BUCKET
      value: "dify"
    - name: OPENDAL_S3_ENDPOINT
      value: "http://minio.devops.svc.cluster.local:9000"
    - name: OPENDAL_S3_REGION
      value: "us-east-1"
    - name: OPENDAL_S3_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: dify-minio-secret
          key: S3_ACCESS_KEY
    - name: OPENDAL_S3_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: dify-minio-secret
          key: S3_SECRET_KEY
  # Base URL for access. If empty, redirect/CORS errors and port-forward/Ingress won't work.
  # install.sh replaces DIFY_BASE_URL_REPLACE with actual URL (default: https://dify.k8s_domain)
  # For port-forward only: DIFY_BASE_URL=http://localhost:8080 bash install.sh
  url:
    consoleApi: "DIFY_BASE_URL_REPLACE"
    consoleWeb: "DIFY_BASE_URL_REPLACE"
    serviceApi: "DIFY_BASE_URL_REPLACE"
    appApi: "DIFY_BASE_URL_REPLACE"
    appWeb: "DIFY_BASE_URL_REPLACE"
    files: "DIFY_BASE_URL_REPLACE"
  secretKey: "sk-dify-change-me-in-production-42chars-minimum"
  migration: true
  # NFS PVC (RWX) for api/worker shared. NFS provisioner must be installed first (dynamic-provisioning/nfs)
  persistence:
    persistentVolumeClaim:
      storageClass: "nfs-client"
      accessModes: ReadWriteMany
      size: 5Gi

worker:
  extraEnv:
    - name: VECTOR_STORE
      value: "qdrant"
    - name: QDRANT_URL
      value: "http://qdrant.rag.svc.cluster.local:6333"
    - name: QDRANT_API_KEY
      value: ""
    - name: STORAGE_TYPE
      value: "opendal"
    - name: OPENDAL_SCHEME
      value: "s3"
    - name: OPENDAL_S3_BUCKET
      value: "dify"
    - name: OPENDAL_S3_ENDPOINT
      value: "http://minio.devops.svc.cluster.local:9000"
    - name: OPENDAL_S3_REGION
      value: "us-east-1"
    - name: OPENDAL_S3_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: dify-minio-secret
          key: S3_ACCESS_KEY
    - name: OPENDAL_S3_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: dify-minio-secret
          key: S3_SECRET_KEY

# Use built-in PostgreSQL, Redis (chart defaults)
postgresql:
  enabled: true
  auth:
    replicationPassword: "difyai123456"
  global:
    storageClass: ""
    postgresql:
      auth:
        postgresPassword: "difyai123456"
        replicationPassword: "difyai123456"
        database: "dify"

redis:
  enabled: true
  auth:
    password: "difyai123456"

# Disable Weaviate (using Qdrant)
weaviate:
  enabled: false

# pluginDaemon also uses NFS shared storage (RWX)
pluginDaemon:
  persistence:
    persistentVolumeClaim:
      storageClass: "nfs-client"
      accessModes: ReadWriteMany
      size: 5Gi

# Ingress: apply separately via dify-ingress.yaml (install.sh substitutes k8s_project/k8s_domain)
ingress:
  enabled: false

service:
  type: ClusterIP
  port: 80
