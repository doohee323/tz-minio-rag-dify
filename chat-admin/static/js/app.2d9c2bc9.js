(function(){"use strict";var t={8891:function(t,e,s){var r=s(2856),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("header",{staticClass:"app-header"},[e("router-link",{staticClass:"logo",attrs:{to:"/"}},[t._v("TZ-Chat Gateway")]),e("nav",{staticClass:"nav-right"},[t.isAuthPage?t._e():[e("router-link",{staticClass:"nav-link",attrs:{to:"/register"}},[t._v("회원가입")]),e("router-link",{staticClass:"nav-link",attrs:{to:"/login"}},[t._v("로그인")])]],2)],1),e("main",{staticClass:"app-main"},[e("router-view")],1)])},n=[],i={name:"App",computed:{isAuthPage(){return["/login","/register"].includes(this.$route.path)}}},o=i,l=s(1656),c=(0,l.A)(o,a,n,!1,null,null,null),u=c.exports,d=s(1594),h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"intro wrap"},[e("h1",[t._v("TZ-Chat Gateway")]),e("p",{staticClass:"tagline"},[t._v("Unified chat API in front of Dify. Part of the tz-chatbot stack.")]),t._m(0),t._m(1),e("h2",{staticClass:"section-title"},[t._v("1. Workflow")]),e("p",{staticClass:"tagline tagline-sm"},[t._v("Check out this repo, use sample apps (DrillQuiz / CoinTutor) as reference to register and apply your app.")]),t._m(2),e("div",{staticClass:"links"},[e("a",{attrs:{href:"https://github.com/doohee323/tz-chatbot",target:"_blank",rel:"noopener"}},[t._v("GitHub source")]),e("a",{attrs:{href:t.apiBase+"/docs",target:"_blank",rel:"noopener"}},[t._v("API docs (OpenAPI)")]),e("router-link",{attrs:{to:"/chat"}},[t._v("Chat page")]),e("a",{attrs:{href:t.apiBase+"/cache",target:"_blank",rel:"noopener"}},[t._v("Cache / history (API key required)")])],1),t._m(3)])},p=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"card"},[e("h2",[t._v("What this is")]),e("p",[t._v(" This service is the "),e("strong",[t._v("TZ-Chat Gateway")]),t._v(": a single API and chat UI for multiple apps (e.g. DrillQuiz, CoinTutor). It sits in front of "),e("a",{staticClass:"link",attrs:{href:"https://dify.ai",target:"_blank",rel:"noopener"}},[t._v("Dify")]),t._v(", manages users and conversations, and can sync chat history to its own database for support and analytics. Sample integration: "),e("a",{staticClass:"link",attrs:{href:"https://devops.drillquiz.com/",target:"_blank",rel:"noopener"}},[t._v("devops.drillquiz.com")]),t._v(" (DrillQuiz). ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"card"},[e("h2",[t._v("Project: tz-chatbot")]),e("p",[t._v(" The full stack runs on Kubernetes: "),e("strong",[t._v("MinIO")]),t._v(" (object store), "),e("strong",[t._v("Qdrant")]),t._v(" (vector DB), "),e("strong",[t._v("RAG backends")]),t._v(" (CoinTutor / DrillQuiz), "),e("strong",[t._v("Dify")]),t._v(" (chatbots), and this "),e("strong",[t._v("TZ-Chat Gateway")]),t._v(". RAG ingestion runs on a schedule; Dify apps call the RAG backends as tools. ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"diagram"},[e("div",{staticClass:"diagram-title"},[t._v("Flow: add your app, then use chat")]),e("div",{staticClass:"flow-row"},[e("span",{staticClass:"flow-step"},[t._v("1. Check out this code")]),e("span",{staticClass:"flow-arrow"},[t._v("→")]),e("span",{staticClass:"flow-step"},[t._v("2. Register your app (reference: DrillQuiz / CoinTutor)")]),e("span",{staticClass:"flow-arrow"},[t._v("→")]),e("span",{staticClass:"flow-step"},[t._v("3. Get token & open chat page")]),e("span",{staticClass:"flow-arrow"},[t._v("→")]),e("span",{staticClass:"flow-step"},[t._v("4. Chat")])])])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"footer"},[t._v(" Chat page requires a valid JWT ("),e("code",[t._v("?token=...")]),t._v("). Use the chat from DrillQuiz or CoinTutor, or obtain a token via "),e("code",[t._v("GET /v1/chat-token")]),t._v(" with "),e("code",[t._v("X-API-Key")]),t._v(". ")])}];const v={NODE_ENV:"production",VUE_APP_ENVIRONMENT:"production",BASE_URL:"/"}.VUE_APP_API_BASE||"",m="undefined"===typeof window||v?v:window.location.origin;var f={name:"Intro",data(){return{apiBase:m}}},_=f,g=(0,l.A)(_,h,p,!1,null,"937dc3ac",null),y=g.exports,C=function(){var t=this,e=t._self._c;return t.init?e("div",{staticClass:"chat-page"},[t.init.embed?t._e():e("div",{staticClass:"header"},[e("span",[t._v("System: "+t._s(t.init.systemId)+" · User: "+t._s(t.init.userId))])]),e("div",{staticClass:"layout",class:{"layout--embed":t.init.embed}},[t.init.embed?t._e():e("aside",{staticClass:"sidebar"},[e("h3",[t._v("Conversations")]),e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.newConversation}},[t._v(t._s(t.t.sendNew))]),e("ul",{staticClass:"conv-list"},t._l(t.conversations,function(s){return e("li",{key:s.id,class:{active:s.id===t.currentConversationId},on:{click:function(e){return t.selectConversation(s.id)}}},[t._v(t._s(s.name||s.id||"(Conversation)"))])}),0)]),e("main",{staticClass:"main"},[e("div",{ref:"messages",staticClass:"messages"},[e("p",{directives:[{name:"show",rawName:"v-show",value:0===t.messages.length,expression:"messages.length === 0"}],staticClass:"empty-state"},[t._v(t._s(t.emptyText))]),t._l(t.messages,function(s,r){return e("div",{key:r,class:["msg","msg-"+s.role]},[e("div",{staticClass:"msg-role"},[t._v(t._s("user"===s.role?t.t.me:t.t.bot))]),e("div",{domProps:{innerHTML:t._s(t.escapeHtml(s.content))}})])})],2),e("div",{staticClass:"error"},[t._v(t._s(t.error))]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.inputText,expression:"inputText"}],attrs:{type:"text",placeholder:t.t.placeholder,autocomplete:"off"},domProps:{value:t.inputText},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.sendMessage.apply(null,arguments))},input:function(e){e.target.composing||(t.inputText=e.target.value)}}}),e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.sendMessage}},[t._v(t._s(t.t.send))])])])])]):e("div",{staticClass:"chat-page chat-page--no-init"},[t._m(0),e("p",[e("router-link",{attrs:{to:"/"}},[t._v("← Back to intro")])],1)])},w=[function(){var t=this,e=t._self._c;return e("p",[t._v("Token is required. Add "),e("code",[t._v("?token=<JWT>")]),t._v(" to the URL, or get a token via "),e("code",[t._v("GET /v1/chat-token")]),t._v(".")])}];s(4114),s(8111),s(1701),s(9112),s(3110),s(4979),s(4603),s(7566),s(8721);const b=["en","es","ko","zh","ja"],k={en:{placeholder:"Type a message...",send:"Send",sendNew:"New conversation",empty:"Type a message.",emptyFull:"Start a new chat or select one from the list.",me:"Me",bot:"Bot",errorList:"Failed to load conversations.",errorMessages:"Failed to load messages.",errorSend:"Send failed."},es:{placeholder:"Escribe un mensaje...",send:"Enviar",sendNew:"Nueva conversación",empty:"Escribe un mensaje.",emptyFull:"Inicia un chat nuevo o elige uno de la lista.",me:"Yo",bot:"Bot",errorList:"Error al cargar conversaciones.",errorMessages:"Error al cargar mensajes.",errorSend:"Error al enviar."},ko:{placeholder:"메시지를 입력하세요...",send:"전송",sendNew:"새 대화",empty:"메시지를 입력하세요.",emptyFull:"새 대화를 시작하거나 왼쪽에서 대화를 선택하세요.",me:"나",bot:"봇",errorList:"대화 목록 조회 실패.",errorMessages:"메시지 조회 실패.",errorSend:"전송 실패."},zh:{placeholder:"输入消息...",send:"发送",sendNew:"新对话",empty:"输入消息。",emptyFull:"开始新对话或从列表中选择。",me:"我",bot:"助手",errorList:"加载对话列表失败。",errorMessages:"加载消息失败。",errorSend:"发送失败。"},ja:{placeholder:"メッセージを入力...",send:"送信",sendNew:"新しい会話",empty:"メッセージを入力してください。",emptyFull:"新しい会話を始めるか、一覧から選択してください。",me:"自分",bot:"ボット",errorList:"会話一覧の取得に失敗しました。",errorMessages:"メッセージの取得に失敗しました。",errorSend:"送信に失敗しました。"}};function I(t){if(t&&b.includes(t))return t;const e=(navigator.language||navigator.userLanguage||"").toLowerCase();return e.startsWith("ko")?"ko":e.startsWith("ja")?"ja":e.startsWith("zh")?"zh":e.startsWith("es")?"es":"en"}var T={name:"Chat",data(){let t="undefined"!==typeof window&&window.__CHAT_INIT__||{};if(!t.token&&"undefined"!==typeof window){const e=new URLSearchParams(window.location.search),r=e.get("token"),a="1"===e.get("embed"),n=e.get("lang")||"";if(r)try{const e=JSON.parse(atob(r.split(".")[1]));t={token:r,systemId:e.system_id||"",userId:e.user_id||"",embed:a,lang:n}}catch(s){t={}}}const e=I(t.lang||null);return{init:t.token&&void 0!==t.systemId&&void 0!==t.userId?t:null,lang:e,t:k[e]||k.en,conversations:[],currentConversationId:null,messages:[],inputText:"",error:""}},computed:{emptyText(){return this.init&&this.init.embed?this.t.empty:this.t.emptyFull}},mounted(){this.init&&!this.init.embed&&this.loadConversations()},updated(){this.$nextTick(()=>{const t=this.$refs.messages;t&&(t.scrollTop=t.scrollHeight)})},methods:{authHeader(){return{Authorization:"Bearer "+this.init.token,"Content-Type":"application/json"}},escapeHtml(t){if(null==t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML},newConversation(){this.currentConversationId=null,this.messages=[],this.error=""},async loadConversations(){if(this.init&&!this.init.embed)try{const t=await fetch("/v1/conversations?system_id="+encodeURIComponent(this.init.systemId)+"&user_id="+encodeURIComponent(this.init.userId),{headers:this.authHeader()});if(!t.ok)throw new Error(this.t.errorList);this.conversations=await t.json()}catch(t){this.error=t.message||this.t.errorList}},async selectConversation(t){if(this.init&&!this.init.embed&&(this.currentConversationId=t,this.messages=[],t))try{const e=await fetch("/v1/conversations/"+encodeURIComponent(t)+"/messages?system_id="+encodeURIComponent(this.init.systemId)+"&user_id="+encodeURIComponent(this.init.userId),{headers:this.authHeader()});if(!e.ok)throw new Error(this.t.errorMessages);const s=await e.json();this.messages=s.map(t=>({role:t.role,content:t.content}))}catch(e){this.error=e.message||this.t.errorMessages}},async sendMessage(){const t=this.inputText.trim();if(t&&this.init){this.error="",this.inputText="",this.messages.push({role:"user",content:t});try{const s={message:t,inputs:{language:this.lang}};this.currentConversationId&&(s.conversation_id=this.currentConversationId);const r=await fetch("/v1/chat",{method:"POST",headers:this.authHeader(),body:JSON.stringify(s)});if(!r.ok){const t=await r.text();let s=t;try{const e=JSON.parse(t);e.detail&&(s="string"===typeof e.detail?e.detail:JSON.stringify(e.detail))}catch(e){}throw new Error(s||this.t.errorSend)}const a=await r.json();a.conversation_id&&(this.currentConversationId=a.conversation_id),this.messages.push({role:"assistant",content:a.answer||""}),this.init.embed||this.loadConversations()}catch(s){this.error=s.message||this.t.errorSend}}}}},x=T,A=(0,l.A)(x,C,w,!1,null,"bb978e84",null),N=A.exports,S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-page"},[e("div",{staticClass:"login-card"},[e("h1",[t._v("로그인")]),e("p",{staticClass:"subtitle"},[t._v("User ID를 입력하면 Chat 페이지로 이동합니다.")]),e("form",{staticClass:"login-form",on:{submit:function(e){return e.preventDefault(),t.handleLogin.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"system_id"}},[t._v("System ID")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.systemId,expression:"systemId"}],staticClass:"form-input",attrs:{id:"system_id"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.systemId=e.target.multiple?s:s[0]}}},[e("option",{attrs:{value:"cointutor"}},[t._v("cointutor")]),e("option",{attrs:{value:"drillquiz"}},[t._v("drillquiz")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"user_id"}},[t._v("User ID")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.userId,expression:"userId"}],staticClass:"form-input",attrs:{id:"user_id",type:"text",placeholder:"사용자 ID (예: user123)",required:""},domProps:{value:t.userId},on:{input:function(e){e.target.composing||(t.userId=e.target.value)}}})]),t.error?e("p",{staticClass:"error-msg"},[t._v(t._s(t.error))]):t._e(),e("button",{staticClass:"btn-submit",attrs:{type:"submit",disabled:t.loading}},[t._v(" "+t._s(t.loading?"로그인 중...":"로그인 후 Chat 열기")+" ")])]),e("p",{staticClass:"footer-note"},[e("router-link",{attrs:{to:"/register"}},[t._v("회원가입")])],1)])])},O=[],E={name:"Login",data(){return{systemId:"cointutor",userId:"",loading:!1,error:""}},methods:{async handleLogin(){this.error="",this.loading=!0;try{const e=await fetch("/v1/chat-token-guest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({system_id:this.systemId,user_id:this.userId.trim()})});if(!e.ok){const s=await e.text();let r=s;try{const t=JSON.parse(s);t.detail&&(r="string"===typeof t.detail?t.detail:JSON.stringify(t.detail))}catch(t){}throw new Error(r||"토큰 발급 실패")}const s=await e.json(),r=s.token;if(!r)throw new Error("토큰을 받지 못했습니다.");this.$router.push({path:"/chat",query:{token:r}})}catch(e){this.error=e.message||"로그인에 실패했습니다."}finally{this.loading=!1}}}},P=E,j=(0,l.A)(P,S,O,!1,null,"6c8e4cad",null),D=j.exports,z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"register-page"},[e("div",{staticClass:"register-card"},[e("h1",[t._v("회원가입")]),e("p",{staticClass:"subtitle"},[t._v("User ID를 입력하면 Chat을 사용할 수 있습니다.")]),e("form",{staticClass:"register-form",on:{submit:function(e){return e.preventDefault(),t.handleRegister.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"system_id"}},[t._v("System ID")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.systemId,expression:"systemId"}],staticClass:"form-input",attrs:{id:"system_id"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.systemId=e.target.multiple?s:s[0]}}},[e("option",{attrs:{value:"cointutor"}},[t._v("cointutor")]),e("option",{attrs:{value:"drillquiz"}},[t._v("drillquiz")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"user_id"}},[t._v("User ID")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.userId,expression:"userId"}],staticClass:"form-input",attrs:{id:"user_id",type:"text",placeholder:"사용할 ID (예: user123)",required:""},domProps:{value:t.userId},on:{input:function(e){e.target.composing||(t.userId=e.target.value)}}})]),t.error?e("p",{staticClass:"error-msg"},[t._v(t._s(t.error))]):t._e(),e("button",{staticClass:"btn-submit",attrs:{type:"submit",disabled:t.loading}},[t._v(" "+t._s(t.loading?"가입 중...":"가입 후 Chat 열기")+" ")])]),e("p",{staticClass:"footer-note"},[t._v(" 이미 계정이 있으신가요? "),e("router-link",{attrs:{to:"/login"}},[t._v("로그인")])],1)])])},L=[],U={name:"Register",data(){return{systemId:"cointutor",userId:"",loading:!1,error:""}},methods:{async handleRegister(){this.error="",this.loading=!0;try{const e=await fetch("/v1/chat-token-guest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({system_id:this.systemId,user_id:this.userId.trim()})});if(!e.ok){const s=await e.text();let r=s;try{const t=JSON.parse(s);t.detail&&(r="string"===typeof t.detail?t.detail:JSON.stringify(t.detail))}catch(t){}throw new Error(r||"토큰 발급 실패")}const s=await e.json(),r=s.token;if(!r)throw new Error("토큰을 받지 못했습니다.");this.$router.push({path:"/chat",query:{token:r}})}catch(e){this.error=e.message||"가입에 실패했습니다."}finally{this.loading=!1}}}},R=U,M=(0,l.A)(R,z,L,!1,null,"eea657e6",null),q=M.exports;r.Ay.use(d.Ay);const J=[{path:"/",name:"Intro",component:y},{path:"/login",name:"Login",component:D},{path:"/register",name:"Register",component:q},{path:"/chat",name:"Chat",component:N}],G=new d.Ay({mode:"history",base:"/",routes:J});var H=G;r.Ay.config.productionTip=!1,new r.Ay({router:H,render:t=>t(u)}).$mount("#app")}},e={};function s(r){var a=e[r];if(void 0!==a)return a.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,s),n.exports}s.m=t,function(){var t=[];s.O=function(e,r,a,n){if(!r){var i=1/0;for(u=0;u<t.length;u++){r=t[u][0],a=t[u][1],n=t[u][2];for(var o=!0,l=0;l<r.length;l++)(!1&n||i>=n)&&Object.keys(s.O).every(function(t){return s.O[t](r[l])})?r.splice(l--,1):(o=!1,n<i&&(i=n));if(o){t.splice(u--,1);var c=a();void 0!==c&&(e=c)}}return e}n=n||0;for(var u=t.length;u>0&&t[u-1][2]>n;u--)t[u]=t[u-1];t[u]=[r,a,n]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var r in e)s.o(e,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,r){var a,n,i=r[0],o=r[1],l=r[2],c=0;if(i.some(function(e){return 0!==t[e]})){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(l)var u=l(s)}for(e&&e(r);c<i.length;c++)n=i[c],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(u)},r=self["webpackChunkchat_gateway_frontend"]=self["webpackChunkchat_gateway_frontend"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=s.O(void 0,[504],function(){return s(8891)});r=s.O(r)})();
//# sourceMappingURL=app.2d9c2bc9.js.map