(function(){"use strict";var e={9754:function(e,t,s){var a=s(2856),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("header",{staticClass:"app-header"},[t("router-link",{staticClass:"logo",attrs:{to:"/"}},[e._v("TZ-Chat Gateway")]),t("nav",{staticClass:"nav-right"},[e.isAdminArea?[t("router-link",{staticClass:"nav-link",attrs:{to:"/admin/systems"}},[e._v("채팅관리")]),t("router-link",{staticClass:"nav-link",attrs:{to:"/admin"}},[e._v("채팅조회")])]:[t("router-link",{staticClass:"nav-link",attrs:{to:"/register"}},[e._v("회원가입")]),t("router-link",{staticClass:"nav-link",attrs:{to:"/login"}},[e._v("로그인")])]],2)],1),t("main",{staticClass:"app-main"},[t("router-view")],1)])},i=[],o={name:"App",computed:{isAdminArea(){return this.$route.path.startsWith("/admin")}}},n=o,l=s(1656),d=(0,l.A)(n,r,i,!1,null,null,null),c=d.exports,m=s(1594),u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"intro wrap"},[t("h1",[e._v("TZ-Chat Gateway")]),t("p",{staticClass:"tagline"},[e._v("Unified chat API in front of Dify. Part of the tz-chatbot stack.")]),e._m(0),e._m(1),t("h2",{staticClass:"section-title"},[e._v("1. Workflow")]),t("p",{staticClass:"tagline tagline-sm"},[e._v("Check out this repo, use sample apps (DrillQuiz / CoinTutor) as reference to register and apply your app.")]),e._m(2),t("div",{staticClass:"links"},[t("a",{attrs:{href:"https://github.com/doohee323/tz-chatbot",target:"_blank",rel:"noopener"}},[e._v("GitHub source")]),t("a",{attrs:{href:e.apiBase+"/docs",target:"_blank",rel:"noopener"}},[e._v("API docs (OpenAPI)")]),t("router-link",{attrs:{to:"/chat"}},[e._v("Chat page")]),t("a",{attrs:{href:e.apiBase+"/cache",target:"_blank",rel:"noopener"}},[e._v("Cache / history (API key required)")])],1),e._m(3)])},p=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"card"},[t("h2",[e._v("What this is")]),t("p",[e._v(" This service is the "),t("strong",[e._v("TZ-Chat Gateway")]),e._v(": a single API and chat UI for multiple apps (e.g. DrillQuiz, CoinTutor). It sits in front of "),t("a",{staticClass:"link",attrs:{href:"https://dify.ai",target:"_blank",rel:"noopener"}},[e._v("Dify")]),e._v(", manages users and conversations, and can sync chat history to its own database for support and analytics. Sample integration: "),t("a",{staticClass:"link",attrs:{href:"https://devops.drillquiz.com/",target:"_blank",rel:"noopener"}},[e._v("devops.drillquiz.com")]),e._v(" (DrillQuiz). ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"card"},[t("h2",[e._v("Project: tz-chatbot")]),t("p",[e._v(" The full stack runs on Kubernetes: "),t("strong",[e._v("MinIO")]),e._v(" (object store), "),t("strong",[e._v("Qdrant")]),e._v(" (vector DB), "),t("strong",[e._v("RAG backends")]),e._v(" (CoinTutor / DrillQuiz), "),t("strong",[e._v("Dify")]),e._v(" (chatbots), and this "),t("strong",[e._v("TZ-Chat Gateway")]),e._v(". RAG ingestion runs on a schedule; Dify apps call the RAG backends as tools. ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"diagram"},[t("div",{staticClass:"diagram-title"},[e._v("Flow: add your app, then use chat")]),t("div",{staticClass:"flow-row"},[t("span",{staticClass:"flow-step"},[e._v("1. Check out this code")]),t("span",{staticClass:"flow-arrow"},[e._v("→")]),t("span",{staticClass:"flow-step"},[e._v("2. Register your app (reference: DrillQuiz / CoinTutor)")]),t("span",{staticClass:"flow-arrow"},[e._v("→")]),t("span",{staticClass:"flow-step"},[e._v("3. Get token & open chat page")]),t("span",{staticClass:"flow-arrow"},[e._v("→")]),t("span",{staticClass:"flow-step"},[e._v("4. Chat")])])])},function(){var e=this,t=e._self._c;return t("p",{staticClass:"footer"},[e._v(" Chat page requires a valid JWT ("),t("code",[e._v("?token=...")]),e._v("). Use the chat from DrillQuiz or CoinTutor, or obtain a token via "),t("code",[e._v("GET /v1/chat-token")]),e._v(" with "),t("code",[e._v("X-API-Key")]),e._v(". ")])}];const v={NODE_ENV:"production",VUE_APP_ENVIRONMENT:"production",BASE_URL:"/"}.VUE_APP_API_BASE||"",h="undefined"===typeof window||v?v:window.location.origin;var f={name:"Intro",data(){return{apiBase:h}}},_=f,g=(0,l.A)(_,u,p,!1,null,"937dc3ac",null),y=g.exports,w=function(){var e=this,t=e._self._c;return e.init?t("div",{staticClass:"chat-page"},[e.init.embed?e._e():t("div",{staticClass:"header"},[t("span",[e._v("System: "+e._s(e.init.systemId)+" · User: "+e._s(e.init.userId))])]),t("div",{staticClass:"layout",class:{"layout--embed":e.init.embed}},[e.init.embed?e._e():t("aside",{staticClass:"sidebar"},[t("h3",[e._v("Conversations")]),t("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.newConversation}},[e._v(e._s(e.t.sendNew))]),t("ul",{staticClass:"conv-list"},e._l(e.conversations,function(s){return t("li",{key:s.id,class:{active:s.id===e.currentConversationId},on:{click:function(t){return e.selectConversation(s.id)}}},[e._v(e._s(s.name||s.id||"(Conversation)"))])}),0)]),t("main",{staticClass:"main"},[t("div",{ref:"messages",staticClass:"messages"},[t("p",{directives:[{name:"show",rawName:"v-show",value:0===e.messages.length,expression:"messages.length === 0"}],staticClass:"empty-state"},[e._v(e._s(e.emptyText))]),e._l(e.messages,function(s,a){return t("div",{key:a,class:["msg","msg-"+s.role]},[t("div",{staticClass:"msg-role"},[e._v(e._s("user"===s.role?e.t.me:e.t.bot))]),t("div",{domProps:{innerHTML:e._s(e.escapeHtml(s.content))}})])})],2),t("div",{staticClass:"error"},[e._v(e._s(e.error))]),t("div",{staticClass:"input-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputText,expression:"inputText"}],attrs:{type:"text",placeholder:e.t.placeholder,autocomplete:"off"},domProps:{value:e.inputText},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.sendMessage.apply(null,arguments))},input:function(t){t.target.composing||(e.inputText=t.target.value)}}}),t("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.sendMessage}},[e._v(e._s(e.t.send))])])])])]):t("div",{staticClass:"chat-page chat-page--no-init"},[e._m(0),t("p",[t("router-link",{attrs:{to:"/"}},[e._v("← Back to intro")])],1)])},C=[function(){var e=this,t=e._self._c;return t("p",[e._v("Token is required. Add "),t("code",[e._v("?token=<JWT>")]),e._v(" to the URL, or get a token via "),t("code",[e._v("GET /v1/chat-token")]),e._v(".")])}];s(4114),s(8111),s(1701),s(9112),s(3110),s(4979),s(4603),s(7566),s(8721);const b=["en","es","ko","zh","ja"],k={en:{placeholder:"Type a message...",send:"Send",sendNew:"New conversation",empty:"Type a message.",emptyFull:"Start a new chat or select one from the list.",me:"Me",bot:"Bot",errorList:"Failed to load conversations.",errorMessages:"Failed to load messages.",errorSend:"Send failed."},es:{placeholder:"Escribe un mensaje...",send:"Enviar",sendNew:"Nueva conversación",empty:"Escribe un mensaje.",emptyFull:"Inicia un chat nuevo o elige uno de la lista.",me:"Yo",bot:"Bot",errorList:"Error al cargar conversaciones.",errorMessages:"Error al cargar mensajes.",errorSend:"Error al enviar."},ko:{placeholder:"메시지를 입력하세요...",send:"전송",sendNew:"새 대화",empty:"메시지를 입력하세요.",emptyFull:"새 대화를 시작하거나 왼쪽에서 대화를 선택하세요.",me:"나",bot:"봇",errorList:"대화 목록 조회 실패.",errorMessages:"메시지 조회 실패.",errorSend:"전송 실패."},zh:{placeholder:"输入消息...",send:"发送",sendNew:"新对话",empty:"输入消息。",emptyFull:"开始新对话或从列表中选择。",me:"我",bot:"助手",errorList:"加载对话列表失败。",errorMessages:"加载消息失败。",errorSend:"发送失败。"},ja:{placeholder:"メッセージを入力...",send:"送信",sendNew:"新しい会話",empty:"メッセージを入力してください。",emptyFull:"新しい会話を始めるか、一覧から選択してください。",me:"自分",bot:"ボット",errorList:"会話一覧の取得に失敗しました。",errorMessages:"メッセージの取得に失敗しました。",errorSend:"送信に失敗しました。"}};function I(e){if(e&&b.includes(e))return e;const t=(navigator.language||navigator.userLanguage||"").toLowerCase();return t.startsWith("ko")?"ko":t.startsWith("ja")?"ja":t.startsWith("zh")?"zh":t.startsWith("es")?"es":"en"}var x={name:"Chat",data(){let e="undefined"!==typeof window&&window.__CHAT_INIT__||{};if(!e.token&&"undefined"!==typeof window){const t=new URLSearchParams(window.location.search),a=t.get("token"),r="1"===t.get("embed"),i=t.get("lang")||"";if(a)try{const t=JSON.parse(atob(a.split(".")[1]));e={token:a,systemId:t.system_id||"",userId:t.user_id||"",embed:r,lang:i}}catch(s){e={}}}const t=I(e.lang||null);return{init:e.token&&void 0!==e.systemId&&void 0!==e.userId?e:null,lang:t,t:k[t]||k.en,conversations:[],currentConversationId:null,messages:[],inputText:"",error:""}},computed:{emptyText(){return this.init&&this.init.embed?this.t.empty:this.t.emptyFull}},mounted(){this.init&&!this.init.embed&&this.loadConversations()},updated(){this.$nextTick(()=>{const e=this.$refs.messages;e&&(e.scrollTop=e.scrollHeight)})},methods:{authHeader(){return{Authorization:"Bearer "+this.init.token,"Content-Type":"application/json"}},escapeHtml(e){if(null==e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML},newConversation(){this.currentConversationId=null,this.messages=[],this.error=""},async loadConversations(){if(this.init&&!this.init.embed)try{const e=await fetch("/v1/conversations?system_id="+encodeURIComponent(this.init.systemId)+"&user_id="+encodeURIComponent(this.init.userId),{headers:this.authHeader()});if(!e.ok)throw new Error(this.t.errorList);this.conversations=await e.json()}catch(e){this.error=e.message||this.t.errorList}},async selectConversation(e){if(this.init&&!this.init.embed&&(this.currentConversationId=e,this.messages=[],e))try{const t=await fetch("/v1/conversations/"+encodeURIComponent(e)+"/messages?system_id="+encodeURIComponent(this.init.systemId)+"&user_id="+encodeURIComponent(this.init.userId),{headers:this.authHeader()});if(!t.ok)throw new Error(this.t.errorMessages);const s=await t.json();this.messages=s.map(e=>({role:e.role,content:e.content}))}catch(t){this.error=t.message||this.t.errorMessages}},async sendMessage(){const e=this.inputText.trim();if(e&&this.init){this.error="",this.inputText="",this.messages.push({role:"user",content:e});try{const s={message:e,inputs:{language:this.lang}};this.currentConversationId&&(s.conversation_id=this.currentConversationId);const a=await fetch("/v1/chat",{method:"POST",headers:this.authHeader(),body:JSON.stringify(s)});if(!a.ok){const e=await a.text();let s=e;try{const t=JSON.parse(e);t.detail&&(s="string"===typeof t.detail?t.detail:JSON.stringify(t.detail))}catch(t){}throw new Error(s||this.t.errorSend)}const r=await a.json();r.conversation_id&&(this.currentConversationId=r.conversation_id),this.messages.push({role:"assistant",content:r.answer||""}),this.init.embed||this.loadConversations()}catch(s){this.error=s.message||this.t.errorSend}}}}},T=x,S=(0,l.A)(T,w,C,!1,null,"bb978e84",null),A=S.exports,N=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-page"},[t("div",{staticClass:"login-card"},[t("h1",[e._v("관리자 로그인")]),t("p",{staticClass:"subtitle"},[e._v("채팅 관리 페이지에 로그인합니다.")]),t("form",{staticClass:"login-form",on:{submit:function(t){return t.preventDefault(),e.handleLogin.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"username"}},[e._v("사용자명")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"form-input",attrs:{id:"username",type:"text",placeholder:"사용자명",required:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[e._v("비밀번호")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-input",attrs:{id:"password",type:"password",placeholder:"비밀번호",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e.error?t("p",{staticClass:"error-msg"},[e._v(e._s(e.error))]):e._e(),t("button",{staticClass:"btn-submit",attrs:{type:"submit",disabled:e.loading}},[e._v(" "+e._s(e.loading?"로그인 중...":"로그인")+" ")])]),t("p",{staticClass:"footer-note"},[t("router-link",{attrs:{to:"/register"}},[e._v("회원가입")])],1)])])},D=[];const P="admin_token";var E={name:"Login",data(){return{username:"",password:"",loading:!1,error:""}},methods:{async handleLogin(){this.error="",this.loading=!0;try{const e=await fetch("/v1/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username.trim(),password:this.password})});if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.detail||"로그인 실패")}const t=await e.json(),s=t.access_token;if(!s)throw new Error("토큰을 받지 못했습니다.");localStorage.setItem(P,s),this.$router.replace("/admin")}catch(e){this.error=e.message||"로그인에 실패했습니다."}finally{this.loading=!1}}}},j=E,O=(0,l.A)(j,N,D,!1,null,"434611de",null),$=O.exports,L=function(){var e=this,t=e._self._c;return t("div",{staticClass:"register-page"},[t("div",{staticClass:"register-card"},[t("h1",[e._v("관리자 회원가입")]),t("p",{staticClass:"subtitle"},[e._v("채팅 관리용 계정을 생성합니다.")]),t("form",{staticClass:"register-form",on:{submit:function(t){return t.preventDefault(),e.handleRegister.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"username"}},[e._v("사용자명")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"form-input",attrs:{id:"username",type:"text",placeholder:"로그인에 사용할 아이디",required:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"name"}},[e._v("이름")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form-input",attrs:{id:"name",type:"text",placeholder:"이름",required:""},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[e._v("이메일")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form-input",attrs:{id:"email",type:"email",placeholder:"your@email.com",required:""},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[e._v("비밀번호")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-input",attrs:{id:"password",type:"password",placeholder:"비밀번호 (6자 이상)",required:"",minlength:"6"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"passwordConfirm"}},[e._v("비밀번호 확인")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.passwordConfirm,expression:"passwordConfirm"}],staticClass:"form-input",attrs:{id:"passwordConfirm",type:"password",placeholder:"비밀번호 재입력",required:"",minlength:"6"},domProps:{value:e.passwordConfirm},on:{input:function(t){t.target.composing||(e.passwordConfirm=t.target.value)}}})]),e.error?t("p",{staticClass:"error-msg"},[e._v(e._s(e.error))]):e._e(),t("button",{staticClass:"btn-submit",attrs:{type:"submit",disabled:e.loading}},[e._v(" "+e._s(e.loading?"가입 중...":"가입")+" ")])]),t("p",{staticClass:"footer-note"},[e._v(" 이미 계정이 있으신가요? "),t("router-link",{attrs:{to:"/login"}},[e._v("로그인")])],1)])])},F=[];const R="admin_token";var U={name:"Register",data(){return{username:"",name:"",email:"",password:"",passwordConfirm:"",loading:!1,error:""}},methods:{async handleRegister(){if(this.error="",this.password.length<6)this.error="비밀번호는 6자 이상이어야 합니다.";else if(this.password===this.passwordConfirm){this.loading=!0;try{const e=await fetch("/v1/admin/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username.trim(),name:this.name.trim(),email:this.email.trim().toLowerCase(),password:this.password,password_confirm:this.passwordConfirm})});if(!e.ok){const t=await e.json().catch(()=>({})),s=Array.isArray(t.detail)&&t.detail[0]?.msg||t.detail;throw new Error("string"===typeof s?s:"가입 실패")}const t=await e.json(),s=t.access_token;if(!s)throw new Error("토큰을 받지 못했습니다.");localStorage.setItem(R,s),this.$router.replace("/admin")}catch(e){this.error=e.message||"가입에 실패했습니다."}finally{this.loading=!1}}else this.error="비밀번호가 일치하지 않습니다."}}},z=U,H=(0,l.A)(z,L,F,!1,null,"218fc616",null),M=H.exports,q=function(){var e=this,t=e._self._c;return t("div",{staticClass:"admin-page"},[t("div",{staticClass:"admin-header"},[t("h1",[e._v("채팅 조회")]),t("button",{staticClass:"btn-logout",on:{click:e.logout}},[e._v("로그아웃")])]),t("div",{staticClass:"filters"},[t("label",[e._v("System "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.filters.systemId,expression:"filters.systemId"}],attrs:{placeholder:"e.g. cointutor"},domProps:{value:e.filters.systemId},on:{input:function(t){t.target.composing||e.$set(e.filters,"systemId",t.target.value)}}})]),t("label",[e._v("User "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.filters.userId,expression:"filters.userId"}],attrs:{placeholder:"e.g. 12345"},domProps:{value:e.filters.userId},on:{input:function(t){t.target.composing||e.$set(e.filters,"userId",t.target.value)}}})]),t("label",[e._v("From "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.filters.fromDate,expression:"filters.fromDate"}],attrs:{type:"date"},domProps:{value:e.filters.fromDate},on:{input:function(t){t.target.composing||e.$set(e.filters,"fromDate",t.target.value)}}})]),t("label",[e._v("To "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.filters.toDate,expression:"filters.toDate"}],attrs:{type:"date"},domProps:{value:e.filters.toDate},on:{input:function(t){t.target.composing||e.$set(e.filters,"toDate",t.target.value)}}})]),t("button",{staticClass:"btn-search",on:{click:e.doSearch}},[e._v("검색")])]),e.error?t("p",{staticClass:"error"},[e._v(e._s(e.error))]):e._e(),t("table",{staticClass:"conv-table"},[e._m(0),t("tbody",e._l(e.conversations,function(s){return t("tr",{key:s.conversation_id,staticClass:"row-click",on:{click:function(t){return e.loadMessages(s)}}},[t("td",[e._v(e._s(s.system_id))]),t("td",[e._v(e._s(s.user_id))]),t("td",[e._v(e._s(s.name||"-"))]),t("td",[e._v(e._s(e.formatDate(s.created_at)))]),t("td",[e._v(e._s(e.formatDate(s.synced_at)))])])}),0)]),e.loading||0!==e.conversations.length?e._e():t("p",{staticClass:"empty"},[e._v("No conversations match.")]),e.selectedConv?t("div",{staticClass:"messages-box"},[t("h3",[e._v("Messages: "+e._s(e.selectedConv.name||e.selectedConv.conversation_id))]),e._l(e.messages,function(s){return t("div",{key:s.message_id,class:["message","msg-"+s.role]},[t("strong",[e._v(e._s("user"===s.role?"User":"Bot"))]),e._v(" "+e._s(e.formatDate(s.created_at))),t("br"),e._v(" "+e._s(s.content)+" ")])})],2):e._e()])},B=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("System")]),t("th",[e._v("User")]),t("th",[e._v("Name")]),t("th",[e._v("Created")]),t("th",[e._v("Synced")])])])}];const G="admin_token";var J={name:"Admin",data(){return{conversations:[],messages:[],selectedConv:null,filters:{systemId:"",userId:"",fromDate:"",toDate:""},loading:!1,error:""}},mounted(){const e=localStorage.getItem(G);e?this.doSearch():this.$router.replace("/login")},methods:{authHeaders(){const e=localStorage.getItem(G);return e?{Authorization:"Bearer "+e}:{}},async doSearch(){this.error="",this.loading=!0;const e=new URLSearchParams;this.filters.systemId.trim()&&e.set("system_id",this.filters.systemId.trim()),this.filters.userId.trim()&&e.set("user_id",this.filters.userId.trim()),this.filters.fromDate&&e.set("from_date",this.filters.fromDate),this.filters.toDate&&e.set("to_date",this.filters.toDate);try{const t=await fetch("/v1/cache/conversations?"+e.toString(),{headers:this.authHeaders()});if(401===t.status)return localStorage.removeItem(G),void this.$router.replace("/login");if(!t.ok)throw new Error(await t.text());this.conversations=await t.json(),this.selectedConv=null,this.messages=[]}catch(t){this.error=t.message}finally{this.loading=!1}},async loadMessages(e){this.error="";try{const t=await fetch("/v1/cache/conversations/"+encodeURIComponent(e.conversation_id)+"/messages",{headers:this.authHeaders()});if(401===t.status)return localStorage.removeItem(G),void this.$router.replace("/login");if(!t.ok)throw new Error("Failed to load messages");this.messages=await t.json(),this.selectedConv=e}catch(t){this.error=t.message}},formatDate(e){if(!e)return"-";try{const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleString()}catch(t){return e}},logout(){localStorage.removeItem(G),this.$router.replace("/login")}}},W=J,Q=(0,l.A)(W,q,B,!1,null,"302368da",null),K=Q.exports,V=function(){var e=this,t=e._self._c;return t("div",{staticClass:"admin-page"},[t("div",{staticClass:"admin-header"},[t("h1",[e._v("채팅 관리")]),t("div",{staticClass:"header-actions"},[t("router-link",{staticClass:"nav-link",attrs:{to:"/admin"}},[e._v("채팅 조회")]),t("button",{staticClass:"btn-add",on:{click:function(t){return e.openForm()}}},[e._v("추가")]),t("button",{staticClass:"btn-logout",on:{click:e.logout}},[e._v("로그아웃")])],1)]),t("table",{staticClass:"systems-table"},[e._m(0),t("tbody",e._l(e.systems,function(s){return t("tr",{key:s.system_id},[t("td",[e._v(e._s(s.system_id))]),t("td",[e._v(e._s(s.display_name||"-"))]),t("td",{staticClass:"url-cell"},[e._v(e._s(s.dify_base_url||"-"))]),t("td",{staticClass:"key-cell"},[e._v(e._s(e.maskKey(s.api_key)))]),t("td",[e._v(e._s(s.enabled?"Y":"N"))]),t("td",[t("button",{staticClass:"btn-edit",on:{click:function(t){return e.openForm(s)}}},[e._v("수정")]),t("button",{staticClass:"btn-del",on:{click:function(t){return e.confirmDelete(s)}}},[e._v("삭제")])])])}),0)]),e.loading||0!==e.systems.length?e._e():t("p",{staticClass:"empty"},[e._v("등록된 시스템이 없습니다. '추가' 버튼으로 등록하세요.")]),e.showForm?t("div",{staticClass:"modal-overlay",on:{click:function(t){return t.target!==t.currentTarget?null:e.closeForm.apply(null,arguments)}}},[t("div",{staticClass:"modal"},[t("h3",[e._v(e._s(e.editing?"시스템 수정":"시스템 추가"))]),t("form",{on:{submit:function(t){return t.preventDefault(),e.save.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("label",[e._v("System ID")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.system_id,expression:"form.system_id"}],attrs:{required:"",disabled:e.editing,placeholder:"e.g. drillquiz"},domProps:{value:e.form.system_id},on:{input:function(t){t.target.composing||e.$set(e.form,"system_id",t.target.value)}}}),e.editing?t("span",{staticClass:"hint"},[e._v("수정 불가")]):e._e()]),t("div",{staticClass:"form-row"},[t("label",[e._v("표시명")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.display_name,expression:"form.display_name"}],attrs:{placeholder:"e.g. DrillQuiz"},domProps:{value:e.form.display_name},on:{input:function(t){t.target.composing||e.$set(e.form,"display_name",t.target.value)}}})]),t("div",{staticClass:"form-row"},[t("label",[e._v("Dify Base URL")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.dify_base_url,expression:"form.dify_base_url"}],attrs:{required:"",placeholder:"https://api.dify.ai/v1"},domProps:{value:e.form.dify_base_url},on:{input:function(t){t.target.composing||e.$set(e.form,"dify_base_url",t.target.value)}}})]),t("div",{staticClass:"form-row"},[t("label",[e._v("Dify API Key")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.dify_api_key,expression:"form.dify_api_key"}],attrs:{type:"password",required:"",placeholder:"app-xxx"},domProps:{value:e.form.dify_api_key},on:{input:function(t){t.target.composing||e.$set(e.form,"dify_api_key",t.target.value)}}})]),t("div",{staticClass:"form-row"},[t("label",[e._v("Gateway API Key")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.api_key,expression:"form.api_key"}],attrs:{type:"password",required:"",placeholder:"key_xxx"},domProps:{value:e.form.api_key},on:{input:function(t){t.target.composing||e.$set(e.form,"api_key",t.target.value)}}})]),t("div",{staticClass:"form-row"},[t("label",[e._v("Allowed Origins (쉼표 구분)")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.allowed_origins,expression:"form.allowed_origins"}],attrs:{placeholder:"https://example.com,https://app.example.com"},domProps:{value:e.form.allowed_origins},on:{input:function(t){t.target.composing||e.$set(e.form,"allowed_origins",t.target.value)}}})]),t("div",{staticClass:"form-row"},[t("label",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.enabled,expression:"form.enabled"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.form.enabled)?e._i(e.form.enabled,null)>-1:e.form.enabled},on:{change:function(t){var s=e.form.enabled,a=t.target,r=!!a.checked;if(Array.isArray(s)){var i=null,o=e._i(s,i);a.checked?o<0&&e.$set(e.form,"enabled",s.concat([i])):o>-1&&e.$set(e.form,"enabled",s.slice(0,o).concat(s.slice(o+1)))}else e.$set(e.form,"enabled",r)}}}),e._v(" 활성")])]),e.formError?t("p",{staticClass:"error"},[e._v(e._s(e.formError))]):e._e(),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:e.closeForm}},[e._v("취소")]),t("button",{staticClass:"btn-save",attrs:{type:"submit",disabled:e.saving}},[e._v(e._s(e.saving?"저장 중...":"저장"))])])])])]):e._e(),e.deleteTarget?t("div",{staticClass:"modal-overlay",on:{click:function(t){if(t.target!==t.currentTarget)return null;e.deleteTarget=null}}},[t("div",{staticClass:"modal"},[t("h3",[e._v("삭제 확인")]),t("p",[e._v(e._s(e.deleteTarget.system_id)+"를 삭제하시겠습니까?")]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:function(t){e.deleteTarget=null}}},[e._v("취소")]),t("button",{staticClass:"btn-del",attrs:{type:"button",disabled:e.deleting},on:{click:e.doDelete}},[e._v(e._s(e.deleting?"삭제 중...":"삭제"))])])])]):e._e()])},Z=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("System ID")]),t("th",[e._v("표시명")]),t("th",[e._v("Dify URL")]),t("th",[e._v("API Key")]),t("th",[e._v("활성")]),t("th",[e._v("관리")])])])}];const Y="admin_token",X="/v1/admin/systems";var ee={name:"AdminSystems",data(){return{systems:[],loading:!1,showForm:!1,editing:null,form:{system_id:"",display_name:"",dify_base_url:"",dify_api_key:"",api_key:"",allowed_origins:"",enabled:!0},formError:"",saving:!1,deleteTarget:null,deleting:!1}},mounted(){const e=localStorage.getItem(Y);e?this.load():this.$router.replace("/login")},methods:{authHeaders(){const e=localStorage.getItem(Y);return e?{Authorization:"Bearer "+e}:{}},async load(){this.loading=!0;try{const e=await fetch(X,{headers:this.authHeaders()});if(401===e.status)return localStorage.removeItem(Y),void this.$router.replace("/login");if(!e.ok)throw new Error(await e.text());this.systems=await e.json()}catch(e){this.formError=e.message}finally{this.loading=!1}},maskKey(e){return e?e.length<=8?"***":e.slice(0,4)+"..."+e.slice(-4):"-"},openForm(e){this.editing=e||null,this.formError="",this.form=e?{system_id:e.system_id,display_name:e.display_name||"",dify_base_url:e.dify_base_url||"",dify_api_key:e.dify_api_key||"",api_key:e.api_key||"",allowed_origins:e.allowed_origins||"",enabled:e.enabled}:{system_id:"",display_name:"",dify_base_url:"",dify_api_key:"",api_key:"",allowed_origins:"",enabled:!0},this.showForm=!0},closeForm(){this.showForm=!1,this.editing=null},async save(){this.formError="",this.saving=!0;try{if(this.editing){const e=await fetch(X+"/"+encodeURIComponent(this.editing.system_id),{method:"PATCH",headers:{...this.authHeaders(),"Content-Type":"application/json"},body:JSON.stringify({display_name:this.form.display_name,dify_base_url:this.form.dify_base_url,dify_api_key:this.form.dify_api_key,api_key:this.form.api_key,allowed_origins:this.form.allowed_origins,enabled:this.form.enabled})});if(401===e.status)return localStorage.removeItem(Y),void this.$router.replace("/login");if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.detail||"수정 실패")}}else{const e=await fetch(X,{method:"POST",headers:{...this.authHeaders(),"Content-Type":"application/json"},body:JSON.stringify(this.form)});if(401===e.status)return localStorage.removeItem(Y),void this.$router.replace("/login");if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.detail||"추가 실패")}}this.closeForm(),await this.load()}catch(e){this.formError=e.message}finally{this.saving=!1}},confirmDelete(e){this.deleteTarget=e,this.deleting=!1},async doDelete(){if(this.deleteTarget){this.deleting=!0;try{const e=await fetch(X+"/"+encodeURIComponent(this.deleteTarget.system_id),{method:"DELETE",headers:this.authHeaders()});if(401===e.status)return localStorage.removeItem(Y),void this.$router.replace("/login");if(!e.ok)throw new Error(await e.text());this.deleteTarget=null,await this.load()}catch(e){this.formError=e.message}finally{this.deleting=!1}}},logout(){localStorage.removeItem(Y),this.$router.replace("/login")}}},te=ee,se=(0,l.A)(te,V,Z,!1,null,"55ebfc1a",null),ae=se.exports;a.Ay.use(m.Ay);const re=[{path:"/",name:"Intro",component:y},{path:"/login",name:"Login",component:$},{path:"/register",name:"Register",component:M},{path:"/admin",name:"Admin",component:K},{path:"/admin/systems",name:"AdminSystems",component:ae},{path:"/chat",name:"Chat",component:A}],ie=new m.Ay({mode:"history",base:"/",routes:re});var oe=ie;a.Ay.config.productionTip=!1,new a.Ay({router:oe,render:e=>e(c)}).$mount("#app")}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,a,r,i){if(!a){var o=1/0;for(c=0;c<e.length;c++){a=e[c][0],r=e[c][1],i=e[c][2];for(var n=!0,l=0;l<a.length;l++)(!1&i||o>=i)&&Object.keys(s.O).every(function(e){return s.O[e](a[l])})?a.splice(l--,1):(n=!1,i<o&&(o=i));if(n){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[a,r,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,i,o=a[0],n=a[1],l=a[2],d=0;if(o.some(function(t){return 0!==e[t]})){for(r in n)s.o(n,r)&&(s.m[r]=n[r]);if(l)var c=l(s)}for(t&&t(a);d<o.length;d++)i=o[d],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(c)},a=self["webpackChunkchat_gateway_frontend"]=self["webpackChunkchat_gateway_frontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(9754)});a=s.O(a)})();
//# sourceMappingURL=app.11f0ab05.js.map