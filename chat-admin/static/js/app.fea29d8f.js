(function(){"use strict";var t={8043:function(t,e,s){var n=s(2856),r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},a=[],o={name:"App"},i=o,c=s(1656),l=(0,c.A)(i,r,a,!1,null,null,null),d=l.exports,u=s(1594),h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"intro wrap"},[e("h1",[t._v("TZ-Chat Gateway")]),e("p",{staticClass:"tagline"},[t._v("Unified chat API in front of Dify. Part of the tz-chatbot stack.")]),t._m(0),t._m(1),e("h2",{staticClass:"section-title"},[t._v("1. Workflow")]),e("p",{staticClass:"tagline tagline-sm"},[t._v("Check out this repo, use sample apps (DrillQuiz / CoinTutor) as reference to register and apply your app.")]),t._m(2),e("div",{staticClass:"links"},[e("a",{attrs:{href:"https://github.com/doohee323/tz-chatbot",target:"_blank",rel:"noopener"}},[t._v("GitHub source")]),e("a",{attrs:{href:t.apiBase+"/docs",target:"_blank",rel:"noopener"}},[t._v("API docs (OpenAPI)")]),e("router-link",{attrs:{to:"/chat"}},[t._v("Chat page")]),e("a",{attrs:{href:t.apiBase+"/cache",target:"_blank",rel:"noopener"}},[t._v("Cache / history (API key required)")])],1),t._m(3)])},p=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"card"},[e("h2",[t._v("What this is")]),e("p",[t._v(" This service is the "),e("strong",[t._v("TZ-Chat Gateway")]),t._v(": a single API and chat UI for multiple apps (e.g. DrillQuiz, CoinTutor). It sits in front of "),e("a",{staticClass:"link",attrs:{href:"https://dify.ai",target:"_blank",rel:"noopener"}},[t._v("Dify")]),t._v(", manages users and conversations, and can sync chat history to its own database for support and analytics. Sample integration: "),e("a",{staticClass:"link",attrs:{href:"https://devops.drillquiz.com/",target:"_blank",rel:"noopener"}},[t._v("devops.drillquiz.com")]),t._v(" (DrillQuiz). ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"card"},[e("h2",[t._v("Project: tz-chatbot")]),e("p",[t._v(" The full stack runs on Kubernetes: "),e("strong",[t._v("MinIO")]),t._v(" (object store), "),e("strong",[t._v("Qdrant")]),t._v(" (vector DB), "),e("strong",[t._v("RAG backends")]),t._v(" (CoinTutor / DrillQuiz), "),e("strong",[t._v("Dify")]),t._v(" (chatbots), and this "),e("strong",[t._v("TZ-Chat Gateway")]),t._v(". RAG ingestion runs on a schedule; Dify apps call the RAG backends as tools. ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"diagram"},[e("div",{staticClass:"diagram-title"},[t._v("Flow: add your app, then use chat")]),e("div",{staticClass:"flow-row"},[e("span",{staticClass:"flow-step"},[t._v("1. Check out this code")]),e("span",{staticClass:"flow-arrow"},[t._v("→")]),e("span",{staticClass:"flow-step"},[t._v("2. Register your app (reference: DrillQuiz / CoinTutor)")]),e("span",{staticClass:"flow-arrow"},[t._v("→")]),e("span",{staticClass:"flow-step"},[t._v("3. Get token & open chat page")]),e("span",{staticClass:"flow-arrow"},[t._v("→")]),e("span",{staticClass:"flow-step"},[t._v("4. Chat")])])])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"footer"},[t._v(" Chat page requires a valid JWT ("),e("code",[t._v("?token=...")]),t._v("). Use the chat from DrillQuiz or CoinTutor, or obtain a token via "),e("code",[t._v("GET /v1/chat-token")]),t._v(" with "),e("code",[t._v("X-API-Key")]),t._v(". ")])}];const v={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_BASE||"",f="undefined"===typeof window||v?v:window.location.origin;var m={name:"Intro",data(){return{apiBase:f}}},_=m,g=(0,c.A)(_,h,p,!1,null,"937dc3ac",null),y=g.exports,C=function(){var t=this,e=t._self._c;return t.init?e("div",{staticClass:"chat-page"},[t.init.embed?t._e():e("div",{staticClass:"header"},[e("span",[t._v("System: "+t._s(t.init.systemId)+" · User: "+t._s(t.init.userId))])]),e("div",{staticClass:"layout",class:{"layout--embed":t.init.embed}},[t.init.embed?t._e():e("aside",{staticClass:"sidebar"},[e("h3",[t._v("Conversations")]),e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.newConversation}},[t._v(t._s(t.t.sendNew))]),e("ul",{staticClass:"conv-list"},t._l(t.conversations,function(s){return e("li",{key:s.id,class:{active:s.id===t.currentConversationId},on:{click:function(e){return t.selectConversation(s.id)}}},[t._v(t._s(s.name||s.id||"(Conversation)"))])}),0)]),e("main",{staticClass:"main"},[e("div",{ref:"messages",staticClass:"messages"},[e("p",{directives:[{name:"show",rawName:"v-show",value:0===t.messages.length,expression:"messages.length === 0"}],staticClass:"empty-state"},[t._v(t._s(t.emptyText))]),t._l(t.messages,function(s,n){return e("div",{key:n,class:["msg","msg-"+s.role]},[e("div",{staticClass:"msg-role"},[t._v(t._s("user"===s.role?t.t.me:t.t.bot))]),e("div",{domProps:{innerHTML:t._s(t.escapeHtml(s.content))}})])})],2),e("div",{staticClass:"error"},[t._v(t._s(t.error))]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.inputText,expression:"inputText"}],attrs:{type:"text",placeholder:t.t.placeholder,autocomplete:"off"},domProps:{value:t.inputText},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.sendMessage.apply(null,arguments))},input:function(e){e.target.composing||(t.inputText=e.target.value)}}}),e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.sendMessage}},[t._v(t._s(t.t.send))])])])])]):e("div",{staticClass:"chat-page chat-page--no-init"},[t._m(0),e("p",[e("router-link",{attrs:{to:"/"}},[t._v("← Back to intro")])],1)])},w=[function(){var t=this,e=t._self._c;return e("p",[t._v("Token is required. Add "),e("code",[t._v("?token=<JWT>")]),t._v(" to the URL, or get a token via "),e("code",[t._v("GET /v1/chat-token")]),t._v(".")])}];s(4114),s(8111),s(1701),s(9112),s(3110),s(4979),s(4603),s(7566),s(8721);const b=["en","es","ko","zh","ja"],k={en:{placeholder:"Type a message...",send:"Send",sendNew:"New conversation",empty:"Type a message.",emptyFull:"Start a new chat or select one from the list.",me:"Me",bot:"Bot",errorList:"Failed to load conversations.",errorMessages:"Failed to load messages.",errorSend:"Send failed."},es:{placeholder:"Escribe un mensaje...",send:"Enviar",sendNew:"Nueva conversación",empty:"Escribe un mensaje.",emptyFull:"Inicia un chat nuevo o elige uno de la lista.",me:"Yo",bot:"Bot",errorList:"Error al cargar conversaciones.",errorMessages:"Error al cargar mensajes.",errorSend:"Error al enviar."},ko:{placeholder:"메시지를 입력하세요...",send:"전송",sendNew:"새 대화",empty:"메시지를 입력하세요.",emptyFull:"새 대화를 시작하거나 왼쪽에서 대화를 선택하세요.",me:"나",bot:"봇",errorList:"대화 목록 조회 실패.",errorMessages:"메시지 조회 실패.",errorSend:"전송 실패."},zh:{placeholder:"输入消息...",send:"发送",sendNew:"新对话",empty:"输入消息。",emptyFull:"开始新对话或从列表中选择。",me:"我",bot:"助手",errorList:"加载对话列表失败。",errorMessages:"加载消息失败。",errorSend:"发送失败。"},ja:{placeholder:"メッセージを入力...",send:"送信",sendNew:"新しい会話",empty:"メッセージを入力してください。",emptyFull:"新しい会話を始めるか、一覧から選択してください。",me:"自分",bot:"ボット",errorList:"会話一覧の取得に失敗しました。",errorMessages:"メッセージの取得に失敗しました。",errorSend:"送信に失敗しました。"}};function I(t){if(t&&b.includes(t))return t;const e=(navigator.language||navigator.userLanguage||"").toLowerCase();return e.startsWith("ko")?"ko":e.startsWith("ja")?"ja":e.startsWith("zh")?"zh":e.startsWith("es")?"es":"en"}var T={name:"Chat",data(){let t="undefined"!==typeof window&&window.__CHAT_INIT__||{};if(!t.token&&"undefined"!==typeof window){const e=new URLSearchParams(window.location.search),n=e.get("token"),r="1"===e.get("embed"),a=e.get("lang")||"";if(n)try{const e=JSON.parse(atob(n.split(".")[1]));t={token:n,systemId:e.system_id||"",userId:e.user_id||"",embed:r,lang:a}}catch(s){t={}}}const e=I(t.lang||null);return{init:t.token&&void 0!==t.systemId&&void 0!==t.userId?t:null,lang:e,t:k[e]||k.en,conversations:[],currentConversationId:null,messages:[],inputText:"",error:""}},computed:{emptyText(){return this.init&&this.init.embed?this.t.empty:this.t.emptyFull}},mounted(){this.init&&!this.init.embed&&this.loadConversations()},updated(){this.$nextTick(()=>{const t=this.$refs.messages;t&&(t.scrollTop=t.scrollHeight)})},methods:{authHeader(){return{Authorization:"Bearer "+this.init.token,"Content-Type":"application/json"}},escapeHtml(t){if(null==t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML},newConversation(){this.currentConversationId=null,this.messages=[],this.error=""},async loadConversations(){if(this.init&&!this.init.embed)try{const t=await fetch("/v1/conversations?system_id="+encodeURIComponent(this.init.systemId)+"&user_id="+encodeURIComponent(this.init.userId),{headers:this.authHeader()});if(!t.ok)throw new Error(this.t.errorList);this.conversations=await t.json()}catch(t){this.error=t.message||this.t.errorList}},async selectConversation(t){if(this.init&&!this.init.embed&&(this.currentConversationId=t,this.messages=[],t))try{const e=await fetch("/v1/conversations/"+encodeURIComponent(t)+"/messages?system_id="+encodeURIComponent(this.init.systemId)+"&user_id="+encodeURIComponent(this.init.userId),{headers:this.authHeader()});if(!e.ok)throw new Error(this.t.errorMessages);const s=await e.json();this.messages=s.map(t=>({role:t.role,content:t.content}))}catch(e){this.error=e.message||this.t.errorMessages}},async sendMessage(){const t=this.inputText.trim();if(t&&this.init){this.error="",this.inputText="",this.messages.push({role:"user",content:t});try{const s={message:t,inputs:{language:this.lang}};this.currentConversationId&&(s.conversation_id=this.currentConversationId);const n=await fetch("/v1/chat",{method:"POST",headers:this.authHeader(),body:JSON.stringify(s)});if(!n.ok){const t=await n.text();let s=t;try{const e=JSON.parse(t);e.detail&&(s="string"===typeof e.detail?e.detail:JSON.stringify(e.detail))}catch(e){}throw new Error(s||this.t.errorSend)}const r=await n.json();r.conversation_id&&(this.currentConversationId=r.conversation_id),this.messages.push({role:"assistant",content:r.answer||""}),this.init.embed||this.loadConversations()}catch(s){this.error=s.message||this.t.errorSend}}}}},A=T,x=(0,c.A)(A,C,w,!1,null,"bb978e84",null),O=x.exports;n.Ay.use(u.Ay);const S=[{path:"/",name:"Intro",component:y},{path:"/chat",name:"Chat",component:O}],j=new u.Ay({mode:"history",base:"/",routes:S});var E=j;n.Ay.config.productionTip=!1,new n.Ay({router:E,render:t=>t(d)}).$mount("#app")}},e={};function s(n){var r=e[n];if(void 0!==r)return r.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,s),a.exports}s.m=t,function(){var t=[];s.O=function(e,n,r,a){if(!n){var o=1/0;for(d=0;d<t.length;d++){n=t[d][0],r=t[d][1],a=t[d][2];for(var i=!0,c=0;c<n.length;c++)(!1&a||o>=a)&&Object.keys(s.O).every(function(t){return s.O[t](n[c])})?n.splice(c--,1):(i=!1,a<o&&(o=a));if(i){t.splice(d--,1);var l=r();void 0!==l&&(e=l)}}return e}a=a||0;for(var d=t.length;d>0&&t[d-1][2]>a;d--)t[d]=t[d-1];t[d]=[n,r,a]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,n){var r,a,o=n[0],i=n[1],c=n[2],l=0;if(o.some(function(e){return 0!==t[e]})){for(r in i)s.o(i,r)&&(s.m[r]=i[r]);if(c)var d=c(s)}for(e&&e(n);l<o.length;l++)a=o[l],s.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return s.O(d)},n=self["webpackChunkchat_gateway_frontend"]=self["webpackChunkchat_gateway_frontend"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=s.O(void 0,[504],function(){return s(8043)});n=s.O(n)})();
//# sourceMappingURL=app.fea29d8f.js.map